<div class="container my-5">
    <div class="row row-cols-1 g-4 my-4">
        <div class="col" *ngFor="let habitacion of habitaciones">
            <div class="card alojamiento-card-horizontal">
                <img [src]="habitacion.foto[0] || 'https://via.placeholder.com/600x400?text=Sin+imagen'" alt="Habitación" class="img-fluid alojamiento-image-horizontal">
                <div class="alojamiento-body-horizontal">
                    <h4>{{habitacion.nombre}}</h4>
                    <p class="alojamiento-descripcion">{{habitacion.descripcion}}</p>
                    <h6>
                        <i class="bi bi-person-fill"></i>
                        X{{habitacion.numeropersonas}}
                    </h6>
                    <div class="servicios-lista" *ngIf="habitacion.servicios?.length">
                        <span class="servicio-chip" *ngFor="let servicio of habitacion.servicios">
                            <span class="servicio-icono">{{ getServicioIcono(servicio) }}</span>
                            <span>{{ servicio }}</span>
                        </span>
                    </div>
                    <h5 class="fw-bold">Desde:COP {{habitacion.precio}} </h5>
                    <button
                        type="button"
                        class="alojamiento-reservar-btn"
                        (click)="abrirFormularioReserva(habitacion)"
                        [disabled]="procesandoReservaId === (habitacion._id || habitacion.id)">
                        {{
                            procesandoReservaId === (habitacion._id || habitacion.id)
                            ? 'Procesando...'
                            : (formularioReservaId === (habitacion._id || habitacion.id) ? 'Ocultar formulario' : 'Reservar ahora')
                        }}
                    </button>

                    <div class="reserva-formulario" *ngIf="formularioReservaId === (habitacion._id || habitacion.id)">
                        <p class="reserva-info" *ngIf="mensajeReserva">{{ mensajeReserva }}</p>
                        <p class="reserva-error" *ngIf="errorReserva">{{ errorReserva }}</p>

                        <div class="reserva-grid">
                            <label>
                                Fecha ingreso
                                <input type="date" [value]="fechainicio" (input)="fechainicio = $any($event.target).value">
                            </label>
                            <label>
                                Fecha salida
                                <input type="date" [value]="fechafin" (input)="fechafin = $any($event.target).value">
                            </label>
                            <label>
                                Adultos
                                <input type="number" min="0" [value]="numeroadultos" (input)="numeroadultos = +$any($event.target).value">
                            </label>
                            <label>
                                Niños
                                <input type="number" min="0" [value]="numeroninos" (input)="numeroninos = +$any($event.target).value">
                            </label>
                        </div>

                        <div class="reserva-acciones">
                            <button
                                type="button"
                                class="alojamiento-reservar-btn"
                                (click)="reservar(habitacion)"
                                [disabled]="procesandoReservaId === (habitacion._id || habitacion.id)">
                                {{ procesandoReservaId === (habitacion._id || habitacion.id) ? 'Procesando...' : 'Continuar al pago' }}
                            </button>
                            <button type="button" class="reserva-cancelar-btn" (click)="cancelarFormularioReserva()">Cancelar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
